(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.richText,n=window.wp.blockEditor,r=window.wp.components,i=window.wp.element,o=window.wp.i18n,a=window.wp.apiFetch;var l=e.n(a);const s=window.ReactJSXRuntime,c=window.gtLinkManagerEditor||{},u={title:(0,o.__)("GT Link","gt-link-manager"),tagName:"span",className:"gt-link"};(0,t.registerFormatType)("gt-link-manager/link-inserter",{...u,edit:function({value:e,onChange:a,isActive:u,activeAttributes:d}){const[p,g]=(0,i.useState)(!1),[m,f]=(0,i.useState)(""),[w,h]=(0,i.useState)([]),[k,x]=(0,i.useState)(!1),[y,_]=(0,i.useState)(""),v=(0,i.useRef)(null),b=(0,i.useRef)(null);function j(e){e&&e.preventDefault()}return(0,i.useEffect)(()=>{if(!p)return;let e=!1;return x(!0),_(""),l()({path:c.restPath+"?search="+encodeURIComponent(m)+"&per_page=20"}).then(t=>{e||h(Array.isArray(t)?t:[])}).catch(()=>{e||(_((0,o.__)("Could not load links.","gt-link-manager")),h([]))}).finally(()=>{e||x(!1)}),()=>{e=!0}},[m,p]),(0,i.useEffect)(()=>{if(!p)return;const e=v.current;if(e&&"function"==typeof e.focus)try{e.focus({preventScroll:!0})}catch{e.focus()}},[p]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.RichTextToolbarButton,{icon:"admin-links",title:(0,o.__)("GT Link","gt-link-manager"),onClick:function(t){if(j(t),p)return void g(!1);t&&t.currentTarget&&(b.current=t.currentTarget);const n=e&&"number"==typeof e.start&&"number"==typeof e.end&&e.text?e.end<=e.start?"":String(e.text).slice(e.start,e.end).trim():"";f(n||""),g(!0)},onMouseDown:j,isActive:u||!(!d||!d.url)}),p&&(0,s.jsx)(r.Popover,{anchor:b.current,onClose:()=>g(!1),placement:"bottom-start",focusOnMount:!1,children:(0,s.jsxs)("div",{style:{padding:"12px",minWidth:"300px"},children:[(0,s.jsx)(r.TextControl,{label:(0,o.__)("Search GT Links","gt-link-manager"),value:m,onChange:f,placeholder:(0,o.__)("Type a link name or slug","gt-link-manager"),ref:v,__nextHasNoMarginBottom:!0}),k&&(0,s.jsx)(r.Spinner,{}),y&&(0,s.jsx)(r.Notice,{status:"error",isDismissible:!1,children:y}),!k&&!y&&w.map(n=>(0,s.jsx)(r.Button,{variant:"secondary",onClick:()=>function(n){const r=(n.rel||"").split(",").map(e=>e.trim()).filter(Boolean).join(" ");a((0,t.applyFormat)(e,{type:"core/link",attributes:{url:n.url,rel:r}})),g(!1)}(n),style:{display:"block",width:"100%",marginBottom:"6px",textAlign:"left"},children:n.name+" ("+n.slug+")"},n.id)),!k&&!y&&!w.length&&(0,s.jsx)("p",{children:(0,o.__)("No links found.","gt-link-manager")})]})})]})}})})();