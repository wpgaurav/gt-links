(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.richText,n=window.wp.blockEditor,i=window.wp.components,r=window.wp.element,a=window.wp.i18n,o=window.wp.apiFetch;var l=t.n(o);const s=window.ReactJSXRuntime,c=window.gtLinkManagerEditor||{},d={title:(0,a.__)("GT Link","gt-link-manager"),tagName:"span",className:"gt-link"};(0,e.registerFormatType)("gt-link-manager/link-inserter",{...d,edit:function({value:t,onChange:o,isActive:u,activeAttributes:p,contentRef:m}){const g=(0,e.useAnchor)({editableContentElement:m?.current,settings:d}),[h,w]=(0,r.useState)(!1),[k,x]=(0,r.useState)(""),[_,f]=(0,r.useState)([]),[y,b]=(0,r.useState)(!1),[v,j]=(0,r.useState)("");return(0,r.useEffect)(()=>{if(!h)return;let t=!1;return b(!0),j(""),l()({path:c.restPath+"?search="+encodeURIComponent(k)+"&per_page=20"}).then(e=>{t||f(Array.isArray(e)?e:[])}).catch(()=>{t||(j((0,a.__)("Could not load links.","gt-link-manager")),f([]))}).finally(()=>{t||b(!1)}),()=>{t=!0}},[k,h]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.RichTextToolbarButton,{icon:"admin-links",title:(0,a.__)("GT Link","gt-link-manager"),onClick:()=>{if(h)return void w(!1);const e=t&&"number"==typeof t.start&&"number"==typeof t.end&&t.text?t.end<=t.start?"":String(t.text).slice(t.start,t.end).trim():"";e&&x(e),w(!0)},isActive:u||!(!p||!p.url)}),h&&(0,s.jsx)(i.Popover,{anchor:g,onClose:()=>w(!1),placement:"bottom-start",children:(0,s.jsxs)("div",{style:{padding:"12px",minWidth:"300px"},children:[(0,s.jsx)(i.TextControl,{label:(0,a.__)("Search GT Links","gt-link-manager"),value:k,onChange:x,placeholder:(0,a.__)("Type a link name or slug","gt-link-manager"),autoFocus:!0,__nextHasNoMarginBottom:!0}),y&&(0,s.jsx)(i.Spinner,{}),v&&(0,s.jsx)(i.Notice,{status:"error",isDismissible:!1,children:v}),!y&&!v&&_.map(n=>(0,s.jsx)(i.Button,{variant:"secondary",onClick:()=>function(n){const i=(n.rel||"").split(",").map(t=>t.trim()).filter(Boolean).join(" ");o((0,e.applyFormat)(t,{type:"core/link",attributes:{url:n.url,rel:i}})),w(!1)}(n),style:{display:"block",width:"100%",marginBottom:"6px",textAlign:"left"},children:n.name+" ("+n.slug+")"},n.id)),!y&&!v&&!_.length&&(0,s.jsx)("p",{children:(0,a.__)("No links found.","gt-link-manager")})]})})]})}})})();