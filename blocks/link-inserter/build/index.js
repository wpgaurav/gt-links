(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.richText,n=window.wp.blockEditor,r=window.wp.components,o=window.wp.element,a=window.wp.i18n,i=window.wp.apiFetch;var l=t.n(i);const s=o.createElement,u=window.gtLinkManagerEditor||{},c={title:(0,a.__)("GT Link","gt-link-manager"),tagName:"span",className:"gt-link"};(0,e.registerFormatType)("gt-link-manager/link-inserter",{...c,edit:function({value:t,onChange:i,isActive:c,activeAttributes:p}){const[g,d]=(0,o.useState)(!1),[m,f]=(0,o.useState)(""),[k,w]=(0,o.useState)([]),[y,h]=(0,o.useState)(!1),[_,v]=(0,o.useState)(""),b=(0,o.useRef)(null),T=(0,o.useRef)(null);function x(t){t&&t.preventDefault()}(0,o.useEffect)(()=>{if(!g)return;let t=!1;return h(!0),v(""),l()({path:u.restPath+"?search="+encodeURIComponent(m)+"&per_page=20"}).then(e=>{t||w(Array.isArray(e)?e:[])}).catch(()=>{t||(v((0,a.__)("Could not load links.","gt-link-manager")),w([]))}).finally(()=>{t||h(!1)}),()=>{t=!0}},[m,g]),(0,o.useEffect)(()=>{if(!g)return;const t=b.current;if(t&&"function"==typeof t.focus)try{t.focus({preventScroll:!0})}catch{t.focus()}},[g]);const S=s("div",{style:{padding:"12px",minWidth:"300px"}},s(r.TextControl,{label:(0,a.__)("Search GT Links","gt-link-manager"),value:m,onChange:f,placeholder:(0,a.__)("Type a link name or slug","gt-link-manager"),ref:b,__nextHasNoMarginBottom:!0}),y&&s(r.Spinner,null),_&&s(r.Notice,{status:"error",isDismissible:!1},_),!y&&!_&&k.map(n=>s(r.Button,{key:n.id,variant:"secondary",onClick:()=>function(n){const r=(n.rel||"").split(",").map(t=>t.trim()).filter(Boolean).join(" ");i((0,e.applyFormat)(t,{type:"core/link",attributes:{url:n.url,rel:r}})),d(!1)}(n),style:{display:"block",width:"100%",marginBottom:"6px",textAlign:"left"}},n.name+" ("+n.slug+")")),!y&&!_&&!k.length&&s("p",null,(0,a.__)("No links found.","gt-link-manager")));return s(o.Fragment,null,s(n.RichTextToolbarButton,{icon:"admin-links",title:(0,a.__)("GT Link","gt-link-manager"),onClick:function(e){if(x(e),g)return void d(!1);e&&e.currentTarget&&(T.current=e.currentTarget);const n=t&&"number"==typeof t.start&&"number"==typeof t.end&&t.text?t.end<=t.start?"":String(t.text).slice(t.start,t.end).trim():"";f(n||""),d(!0)},onMouseDown:x,isActive:c||!(!p||!p.url)}),g&&s(r.Popover,{anchor:T.current,onClose:()=>d(!1),placement:"bottom-start",focusOnMount:!1},S))}})})();