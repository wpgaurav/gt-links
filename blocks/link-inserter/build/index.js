(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.wp.richText,n=window.wp.blockEditor,r=window.wp.components,i=window.wp.element,o=window.wp.i18n,a=window.wp.apiFetch;var l=t.n(a);const s=window.ReactJSXRuntime,c=window.gtLinkManagerEditor||{},u={title:(0,o.__)("GT Link","gt-link-manager"),tagName:"span",className:"gt-link"};(0,e.registerFormatType)("gt-link-manager/link-inserter",{...u,edit:function({value:t,onChange:a,isActive:d,activeAttributes:p,contentRef:m}){const g=(0,e.useAnchor)({editableContentElement:m?.current,settings:u}),[f,h]=(0,i.useState)(!1),[w,k]=(0,i.useState)(""),[x,y]=(0,i.useState)([]),[_,v]=(0,i.useState)(!1),[b,j]=(0,i.useState)(""),S=(0,i.useRef)(null);function C(t){t&&t.preventDefault()}return(0,i.useEffect)(()=>{if(!f)return;let t=!1;return v(!0),j(""),l()({path:c.restPath+"?search="+encodeURIComponent(w)+"&per_page=20"}).then(e=>{t||y(Array.isArray(e)?e:[])}).catch(()=>{t||(j((0,o.__)("Could not load links.","gt-link-manager")),y([]))}).finally(()=>{t||v(!1)}),()=>{t=!0}},[w,f]),(0,i.useEffect)(()=>{if(!f)return;const t=S.current;if(t&&"function"==typeof t.focus)try{t.focus({preventScroll:!0})}catch{t.focus()}},[f]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.RichTextToolbarButton,{icon:"admin-links",title:(0,o.__)("GT Link","gt-link-manager"),onClick:function(e){if(C(e),f)return void h(!1);const n=t&&"number"==typeof t.start&&"number"==typeof t.end&&t.text?t.end<=t.start?"":String(t.text).slice(t.start,t.end).trim():"";k(n||""),h(!0)},onMouseDown:C,isActive:d||!(!p||!p.url)}),f&&(0,s.jsx)(r.Popover,{anchor:g,onClose:()=>h(!1),placement:"bottom-start",focusOnMount:!1,children:(0,s.jsxs)("div",{style:{padding:"12px",minWidth:"300px"},children:[(0,s.jsx)(r.TextControl,{label:(0,o.__)("Search GT Links","gt-link-manager"),value:w,onChange:k,placeholder:(0,o.__)("Type a link name or slug","gt-link-manager"),ref:S,__nextHasNoMarginBottom:!0}),_&&(0,s.jsx)(r.Spinner,{}),b&&(0,s.jsx)(r.Notice,{status:"error",isDismissible:!1,children:b}),!_&&!b&&x.map(n=>(0,s.jsx)(r.Button,{variant:"secondary",onClick:()=>function(n){const r=(n.rel||"").split(",").map(t=>t.trim()).filter(Boolean).join(" ");a((0,e.applyFormat)(t,{type:"core/link",attributes:{url:n.url,rel:r}})),h(!1)}(n),style:{display:"block",width:"100%",marginBottom:"6px",textAlign:"left"},children:n.name+" ("+n.slug+")"},n.id)),!_&&!b&&!x.length&&(0,s.jsx)("p",{children:(0,o.__)("No links found.","gt-link-manager")})]})})]})}})})();